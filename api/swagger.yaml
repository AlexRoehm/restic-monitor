basePath: /api/v1
definitions:
  internal_api.fileResponse:
    properties:
      name:
        example: file.txt
        type: string
      path:
        example: /home/user/documents/file.txt
        type: string
      size:
        example: 2048
        type: integer
      type:
        example: file
        type: string
    type: object
  internal_api.snapshotResponse:
    properties:
      hostname:
        example: myserver
        type: string
      paths:
        items:
          type: string
        type: array
      short_id:
        example: a1b2c3d4
        type: string
      tags:
        items:
          type: string
        type: array
      time:
        example: "2025-11-23T14:30:00Z"
        type: string
      username:
        example: admin
        type: string
    type: object
  internal_api.statusResponse:
    properties:
      checkedAt:
        example: "2025-11-23T15:00:00Z"
        type: string
      disabled:
        example: false
        type: boolean
      fileCount:
        example: 1234
        type: integer
      health:
        example: true
        type: boolean
      latestBackup:
        example: "2025-11-23T14:30:00Z"
        type: string
      latestSnapshotID:
        example: a1b2c3d4
        type: string
      name:
        example: home
        type: string
      snapshotCount:
        example: 42
        type: integer
      statusMessage:
        example: restic check succeeded
        type: string
    type: object
host: localhost:8080
info:
  contact:
    name: API Support
  description: API for monitoring Restic backup repositories
  title: Restic Monitor API
  version: 1.0.0
paths:
  /prune/{name}:
    post:
      consumes:
      - application/json
      description: Applies retention policy (restic forget) to remove old snapshots.
        Use "all" as the name to prune all targets.
      parameters:
      - description: Name of the backup target or 'all' for all targets
        in: path
        name: name
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Prune operation completed successfully
          schema:
            additionalProperties: true
            type: object
        "400":
          description: Bad request
          schema:
            type: string
        "401":
          description: Unauthorized
          schema:
            type: string
        "404":
          description: Target not found
          schema:
            type: string
        "500":
          description: Prune operation failed
          schema:
            type: string
      security:
      - BasicAuth: []
      - BearerAuth: []
      summary: Prune snapshots for a target or all targets
      tags:
      - Maintenance
  /snapshot/{id}:
    get:
      consumes:
      - application/json
      description: Returns the list of files contained in the specified snapshot
      parameters:
      - description: Snapshot ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: List of files
          schema:
            items:
              $ref: '#/definitions/internal_api.fileResponse'
            type: array
        "401":
          description: Unauthorized
          schema:
            type: string
        "404":
          description: Snapshot file list not found
          schema:
            type: string
        "500":
          description: Internal server error
          schema:
            type: string
      security:
      - BasicAuth: []
      - BearerAuth: []
      summary: Get file list for a specific snapshot
      tags:
      - Snapshots
  /snapshots/{name}:
    get:
      consumes:
      - application/json
      description: Returns list of all snapshots for the specified backup target
      parameters:
      - description: Name of the backup target
        in: path
        name: name
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: List of snapshots
          schema:
            items:
              $ref: '#/definitions/internal_api.snapshotResponse'
            type: array
        "401":
          description: Unauthorized
          schema:
            type: string
        "404":
          description: Target not found
          schema:
            type: string
        "500":
          description: Internal server error
          schema:
            type: string
      security:
      - BasicAuth: []
      - BearerAuth: []
      summary: Get snapshots for a specific backup target
      tags:
      - Snapshots
  /status:
    get:
      consumes:
      - application/json
      description: Returns the current status of all configured backup targets including
        health, snapshot counts, and last check time
      parameters:
      - description: Optional filter by target name
        in: query
        name: name
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Array of statuses when no name parameter
          schema:
            items:
              $ref: '#/definitions/internal_api.statusResponse'
            type: array
        "401":
          description: Unauthorized
          schema:
            type: string
        "404":
          description: Target not found
          schema:
            type: string
        "500":
          description: Internal server error
          schema:
            type: string
      security:
      - BasicAuth: []
      - BearerAuth: []
      summary: Get status of all backup targets
      tags:
      - Status
  /status/{name}:
    get:
      consumes:
      - application/json
      description: Returns the current status of a single backup target by name. Optionally
        check if the latest snapshot is younger than a specified age.
      parameters:
      - description: Name of the backup target
        in: path
        name: name
        required: true
        type: string
      - description: Maximum age in hours for the latest snapshot. If specified, health
          status will be true only if repository is healthy AND snapshot is younger
          than maxage hours
        in: query
        minimum: 1
        name: maxage
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: Successful response with backup status
          schema:
            $ref: '#/definitions/internal_api.statusResponse'
        "400":
          description: Bad request - invalid maxage parameter
          schema:
            type: string
        "401":
          description: Unauthorized
          schema:
            type: string
        "404":
          description: Target not found
          schema:
            type: string
        "500":
          description: Internal server error
          schema:
            type: string
      security:
      - BasicAuth: []
      - BearerAuth: []
      summary: Get status of a specific backup target
      tags:
      - Status
  /toggle/{name}:
    post:
      consumes:
      - application/json
      description: Toggles the disabled state of a backup target
      parameters:
      - description: Name of the backup target
        in: path
        name: name
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Target state toggled successfully
          schema:
            additionalProperties: true
            type: object
        "400":
          description: Bad request
          schema:
            type: string
        "401":
          description: Unauthorized
          schema:
            type: string
        "404":
          description: Target not found
          schema:
            type: string
        "500":
          description: Internal server error
          schema:
            type: string
      security:
      - BasicAuth: []
      - BearerAuth: []
      summary: Enable or disable monitoring for a target
      tags:
      - Configuration
  /unlock/{name}:
    post:
      consumes:
      - application/json
      description: Removes stale locks from a Restic repository
      parameters:
      - description: Name of the backup target
        in: path
        name: name
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Repository unlocked successfully
          schema:
            additionalProperties:
              type: string
            type: object
        "400":
          description: Bad request
          schema:
            type: string
        "401":
          description: Unauthorized
          schema:
            type: string
        "404":
          description: Target not found
          schema:
            type: string
        "500":
          description: Unlock failed
          schema:
            type: string
      security:
      - BasicAuth: []
      - BearerAuth: []
      summary: Unlock a repository
      tags:
      - Maintenance
securityDefinitions:
  BasicAuth:
    type: basic
  BearerAuth:
    description: Bearer token authentication using AUTH_TOKEN
    in: header
    name: Authorization
    type: apiKey
swagger: "2.0"
tags:
- description: Backup status and health monitoring
  name: Status
- description: Snapshot information and file listings
  name: Snapshots
- description: Repository maintenance operations
  name: Maintenance
- description: Target configuration management
  name: Configuration
